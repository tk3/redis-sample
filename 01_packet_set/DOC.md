
## どのように動作しているのか

SETリクエストの動作をパケットをみて、そのメッセージ内容を確認する。


パケットをみるため、`stone`を中継する。まずは`stone`を起動する。

```
stone -ppp 127.0.0.1:6379 16379
```

`redis-cli`からSETコマンドを実行してみる。

```
$ redis-cli -p 16379
127.0.0.1:16379> set abcd 0123456789
OK
127.0.0.1:16379> get abcd
"0123456789"
```

SETコマンドのパケットのみ注目する。

```
Sep 20 05:04:52.485256 140087166363456 3 5>6 2a 33 0d 0a 24 33 0d 0a  *3..$3..
Sep 20 05:04:52.485454 140087166363456 3 5>6 73 65 74 0d 0a 24 34 0d  set..$4.
Sep 20 05:04:52.485474 140087166363456 3 5>6 0a 61 62 63 64 0d 0a 24  .abcd..$
Sep 20 05:04:52.485487 140087166363456 3 5>6 31 30 0d 0a 30 31 32 33  10..0123
Sep 20 05:04:52.485501 140087166363456 3 5>6 34 35 36 37 38 39 0d 0a  456789..
Sep 20 05:04:52.485929 140087166363456 3 5<6 2b 4f 4b 0d 0a           +OK..
```

## SET

### SET request

SETコマンドのリクエスト。

[RESP protocol spec | Redis](https://redis.io/docs/reference/protocol-spec/)

```
*3\r\n
$3\r\n
set\r\n
$4\r\n
abcd\r\n
$10\r\n
0123456789\r\n
```

### SET response

SETコマンドのレスポンス。`OK`が返ってきていることがわかる。

```
+OK\r\n
```

## GET

```
Sep 20 05:05:03.341296 140087166363456 3 5>6 2a 32 0d 0a 24 33 0d 0a  *2..$3..
Sep 20 05:05:03.341339 140087166363456 3 5>6 67 65 74 0d 0a 24 34 0d  get..$4.
Sep 20 05:05:03.341355 140087166363456 3 5>6 0a 61 62 63 64 0d 0a     .abcd..
Sep 20 05:05:03.341527 140087166363456 3 5<6 24 31 30 0d 0a 30 31 32  $10..012
Sep 20 05:05:03.341630 140087166363456 3 5<6 33 34 35 36 37 38 39 0d  3456789.
Sep 20 05:05:03.341650 140087166363456 3 5<6 0a                       .
```

